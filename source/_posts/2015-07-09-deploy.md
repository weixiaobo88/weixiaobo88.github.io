title: 部署 
date: 2015-07-09 18:08:50
tags: java
---

部署描述符 Deployment Descriptor简称为DD，也就是所说的web.xml文件

## 为什么要有war
Web应用的目录结构要求很严，各个内容只能放在它该放的地方，移动起来就非常不方便。⋅⋅
所以人们就会把这个目录结构归档为WAR文件（Web ARchive）。⋅⋅

## 有哪些资源需要部署

- 静态资源（图片等）
- JSP页面
- Servlet类、Java其他类
- jar文件
- web.xml部署描述文件
- 其他

## Web应用目录结构（部署资源的目录结构，放在Tomcat下）

```
tomcat
|_webapps
    |_project-name
        |_META-INF 应用部署为WAR时，唯一的新东西就是META-INF目录
            |_MANIFEST.MF 指定库的依赖性
        |_WEB-INF
            |_classes
                |_com.tw classes下面的包结构和开发环境中使用的结构完全一致
                    |_core
                    |_web
            |_lib
            |_web.xml(必须放在WEB-INF中)
    |_form.html
    |_result.jsp
```

## 静态内容如何访问
部署静态HTML和JSP的时候，可以选择是否允许外部直接访问。直接访问指的是用户在浏览器中输入URL得到相应的资源。
只要把文件放在WEB-INF下就能避免直接访问，或者部署为WAR文件的时候放在META-INF下面。
**如果用户请求WEB-INF或META-INF下的文件，会得到404错误**

## 容器在哪里找Web请求的东西，用户如何请求Web应用里的东西
### Servlet映射
“Hello”主要用于开发，用户不会知道这个名字。
“物理目录结构”和“虚拟目录结构”
用户访问：http://localhost:8080/web/hello
虚拟目录结构webapps/web/hello

``` xml

    <servlet>
        <servlet-name>Hello</servlet-name>
        <servlet-class>com.tw.web.HelloServlet</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>Hello</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>
```

三种<url-pattern>，容器会顺序查找匹配，并选择最具体的匹配。

- 完全匹配
- 目录匹配
- 扩展名匹配

## DD中的配置
### 配置默认页面

``` xml

<welcome-file-list>
    <welcome-file>index.html</welcome-file>
    <welcome-file>default.jsp</welcome-file>
</welcome-file-list>

```
<welcome-file>中的元素不能以斜线开头或结束

同样的，也可以声明错误页面，并根据异常或HTTP状态码来声明错误页面。

### 配置servlet初始化

Servlet会在每个请求到来时初始化，经历类加载、实例化和初始化（建立一个ServletContext、调用监听者等等），然后容器才能正常工作：分配线程，调用servlet的service方法。

如果希望在部署或服务器重启时加载servlet，而不是等到第一个请求到来时加载，可以做DD中使用<load-on-startup>元素。当这个元素的值为非零时，容器就会在部署或服务器重启时初始化Servlet。这个值的设置也可以控制加载顺序。


## JSP页面 & JSP文档
正常的JSP是一个页面，如果采用了XML语法来写，就成了一个JSP文档。



## 参考资料
《Head First Servlet JSP》