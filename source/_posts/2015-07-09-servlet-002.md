title: Servlet 完成Web请求和响应 
date: 2015-07-09 18:08:50
tags: servlet
---

## Web 请求和响应的流程
    
用户——》Web 浏览器——URL(所找资源的名字和地址)——》服务器——响应(客户请求的资源)-》用户

### 用户和服务器如何对话
要对话，就需要使用相同的语言，这个语言就是HTTP，而且浏览器必须懂HTML。

HTTP是Web上用户和服务器之间通信所用的协议。
服务器使用HTTP向用户发送HTML。
浏览器接收到HTMl之后要创建Web页面，并将页面显示给用户。

#### HTTP是什么
HTTP超文本传输协议，是TCP/IP的上层协议，依赖于TCP/IP从一处向另一处完整的发送请求和响应。

TCP负责从一个网络节点向另一个网络节点发送的文件能作为一个完整的文件到达目的地，尽管传送过程中可能会分解成小块传输。
IP是一个底层协议，负责把数据包路由到目的地。

**HTTP请求流**
- HTTP方法（要完成的动作，Get/Post/Update/Delete）
- URL（要访问的页面）
- 表单参数

**HTTP响应流**
- 状态码（请求是否成功）
- 内容类型（文本、HTML、图片等）
- 内容（具体的文本、HTML等）

**HTTP方法**
- GET（幂等）    
- POST（非幂等）

在发送这些请求时，会携带信息：HTTP方法、资源路径、参数、协议版本、首部信息

HTTP响应中的MIME类型告诉浏览器要接收的数据是什么类型。


#### HTML是什么
HTTP的响应可以包含HTML，浏览器根据HTTP首部信息来处理HTML页面


### URL是什么
http://weixiaobo88.github.io:80/web/hello.html

- “http://” 协议，告诉服务器通信协议
- “weixiaobo88.github.io” 服务器名，这个名字会映射到一个唯一的IP地址
- :80 端口，默认端口是80
- /web 所请求资源在服务器上的路径
- /hello.html 资源，所请求内容的名字

#### TCP端口是什么
端口并不是一个可以插入物理设备的位置，只表示服务器应用的“逻辑”数而已，用来标识服务器硬件上一个特定的软件程序。
服务器上有65536个端口，端口号范围为“0~65535”，其中0~1023为保留端口，由知名服务使用，比如80端口。

## 一个简单的Apache网站的目录结构
Apache是一个留下的开源Web服务器。
Apache_home
|_ htdocs (Apache服务器中Web应用的根目录)
    |_index.html
    |_app1
        |_index.html
        |_select...
    |_app2
        |_index.html
        |_select...

### Web服务器自己不做的两件事
- 动态内容，比如请求实时的日期
- 在服务器上保存上数据，比如提交表单

那谁来做呢，CGI来做，CGI代表公共网关接口，即Common Gateway Interface。

主要是三者之间的关系：
- Web服务器主机
- Web服务器应用
- 辅助应用（Servlet和CGI在Web服务器中都扮演着辅助应用的角色）

```        
>什么是容器
Servlet没有main()方法，它们受控于另外一个Java应用，就是容器。 Tomcat就是这样的容器。
Web服务器应用（如Apache）得到一个指向servlet的请求时，服务器会把这个请求交给部署该servlet的容器，由容器向servlet提供HTTP请求和响应，调用servlet的doGet()或doPost()的方法。
```
Servlet容器又称为Servlet引擎，它是Java Web服务器（例如：Apache Tomcat）的一部分，用来提供动态网页的服务。
我们知道，Servlet没有main方法，它是不能独立运行的。它必须被部署到Servlet容器中，由容器来实例化和调用Servlet中的方法。因此，Servlet容器的作用是在Servlet的生命周期内包容和管理Servlet。

````
>容器能提供什么
- 通信支持，轻松地让servlet与Web服务器对话，不用建立ServerSocket、监听某个端口、创建流等。不必但系Web服务和自己的Web代码直接的PAI。只专注于servlet中实现的业务逻辑。
- 生命周期管理，容器控制servlet的生与死，负责价值类、实例化和初始化servlet、调用servlet方法，以及垃圾回收等
- 多线程支持，容器会为每个servlet请求创建一个新的Java线程
- 声明方式实现安全，使用XML部署描述文件来配置安全性
- JSP支持，容器将JSP代码翻译成Java
````

容器怎么把servlet映射到URL？
一个servlet有3个名字：
- 客户知道的URL名
- 部署人员知道的秘密内部名
- 实际的文件名

部署描述文件(DD)的作用：
- 把URL映射到servlet
- 定制Web应用的其他方面，比如安全角色、错误页面、初始化配置信息等

## 历史纠结

- Servlet中输出文本 -》Servlet中输出HTML，也就是将HTML放在Java中 -》JSP出现，将Java放在HTML中 
- MVC，业务逻辑与表示分离

        
## 参考资料
《Head First Servlet JSP》
        

》5 属性和监听 P152

