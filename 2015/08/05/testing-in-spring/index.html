<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Testing in Spring | weixiaobo88.github.io</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="单元测试Spring Framework 提供的 Mock Objects
Environment, org.springframework.mock.env package, MockEnvironment and MockPropertySource
JNDI, org.springframework.mock.jndi, JNDI SPI
Servlet API, org.springfra">
<meta property="og:type" content="article">
<meta property="og:title" content="Testing in Spring">
<meta property="og:url" content="http://weixiaobo88.github.io/2015/08/05/testing-in-spring/index.html">
<meta property="og:site_name" content="weixiaobo88.github.io">
<meta property="og:description" content="单元测试Spring Framework 提供的 Mock Objects
Environment, org.springframework.mock.env package, MockEnvironment and MockPropertySource
JNDI, org.springframework.mock.jndi, JNDI SPI
Servlet API, org.springfra">
<meta property="og:updated_time" content="2016-01-21T13:48:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Testing in Spring">
<meta name="twitter:description" content="单元测试Spring Framework 提供的 Mock Objects
Environment, org.springframework.mock.env package, MockEnvironment and MockPropertySource
JNDI, org.springframework.mock.jndi, JNDI SPI
Servlet API, org.springfra">
  
    <link rel="alternative" href="/atom.xml" title="weixiaobo88.github.io" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">weixiaobo88.github.io</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Just do it !</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://weixiaobo88.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-testing-in-spring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/05/testing-in-spring/" class="article-date">
  <time datetime="2015-08-05T02:00:41.000Z" itemprop="datePublished">2015-08-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Testing in Spring
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u5355_u5143_u6D4B_u8BD5"><a href="#u5355_u5143_u6D4B_u8BD5" class="headerlink" title="单元测试"></a>单元测试</h2><h3 id="Spring_Framework__u63D0_u4F9B_u7684_Mock_Objects"><a href="#Spring_Framework__u63D0_u4F9B_u7684_Mock_Objects" class="headerlink" title="Spring Framework 提供的 Mock Objects"></a>Spring Framework 提供的 Mock Objects</h3><ul>
<li>Environment, org.springframework.mock.env package, MockEnvironment and MockPropertySource</li>
<li>JNDI, org.springframework.mock.jndi, JNDI SPI</li>
<li>Servlet API, org.springframework.mock.web, 测试 web contexts, controllers, filters<ul>
<li>Spring MVC and REST Controllers 的集成测试可以参考 <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/integration-testing.html#spring-mvc-test-framework" target="_blank" rel="external">Spring MVC Test Framework</a></li>
</ul>
</li>
<li>Portlet API</li>
</ul>
<h2 id="u96C6_u6210_u6D4B_u8BD5"><a href="#u96C6_u6210_u6D4B_u8BD5" class="headerlink" title="集成测试"></a>集成测试</h2><p>Spring 2.5 以后，在 Spring TestContext Framework 中提供了基于注解的单元测试和集成测试。</p>
<p>Spring 对于集成测试的支持有以下几个主要目标：</p>
<ul>
<li>测试执行过程中管理 Spring IoC 容器缓存</li>
<li>提供测试夹具（test fixture）实例的依赖注入(Dependency Injection)</li>
<li>提供集成测试中的事务管理</li>
<li>提供写集成测试中需要的特定的 Spring 基类</li>
</ul>
<h3 id="JDBC__u6D4B_u8BD5"><a href="#JDBC__u6D4B_u8BD5" class="headerlink" title="JDBC 测试"></a>JDBC 测试</h3><p>使用 JdbcTestUtils</p>
<h3 id="u6CE8_u89E3"><a href="#u6CE8_u89E3" class="headerlink" title="注解"></a>注解</h3><h2 id="Spring_MVC__u6D4B_u8BD5_u6846_u67B6"><a href="#Spring_MVC__u6D4B_u8BD5_u6846_u67B6" class="headerlink" title="Spring MVC 测试框架"></a>Spring MVC 测试框架</h2><p>建立在 spring-test 模块中的 Servlet API mock objects 之上，所以不需要一个运行的 Servlet 容器，它会使用 DispatcherServlet，提供所有的 Spring MVC 的支持，使用 TestContext 框架可以选择性的加载实际的 Spring 配置文件，</p>
<p>Spring MVC 测试提供了 client-side 的测试，使用 RestTemplate 来测试。Client-side 的测试会 mock 服务器的响应，并不需要一个运行的服务器。</p>
<h3 id="Server-Side__u670D_u52A1_u5668_u7AEF_u6D4B_u8BD5"><a href="#Server-Side__u670D_u52A1_u5668_u7AEF_u6D4B_u8BD5" class="headerlink" title="Server-Side 服务器端测试"></a>Server-Side 服务器端测试</h3><h4 id="u914D_u7F6E_u9879_Setup_Options"><a href="#u914D_u7F6E_u9879_Setup_Options" class="headerlink" title="配置项 Setup Options"></a>配置项 Setup Options</h4><p>有两种方式来创建 MockMvc的实例</p>
<ul>
<li>通过 TestContext 框架来加载 Spring MVC 的配置</li>
<li>手动创建 controller 的实例，不用加载 Spring 的配置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// 通过 TestContext 框架来加载 Spring MVC 的配置</span><br><span class="line">import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">@WebAppConfiguration</span><br><span class="line">@ContextConfiguration(<span class="string">"test-servlet-context.xml"</span>)</span><br><span class="line">public class ExampleTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private WebApplicationContext wac;</span><br><span class="line"></span><br><span class="line">    private MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void <span class="function"><span class="title">setup</span></span>() &#123;</span><br><span class="line">        this.mockMvc = MockMvcBuilders.webAppContextSetup(this.wac).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void getAccount() throws Exception &#123;</span><br><span class="line">        this.mockMvc.perform(get(<span class="string">"/accounts/1"</span>).accept(MediaType.parseMediaType(<span class="string">"application/json;charset=UTF-8"</span>)))</span><br><span class="line">            .andExpect(status().isOk())</span><br><span class="line">            .andExpect(content().contentType(<span class="string">"application/json"</span>))</span><br><span class="line">            .andExpect(jsonPath(<span class="string">"$.name"</span>).value(<span class="string">"Lee"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 手动创建 controller 的实例</span><br><span class="line">public class MyWebTests &#123;</span><br><span class="line"></span><br><span class="line">    private MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void <span class="function"><span class="title">setup</span></span>() &#123;</span><br><span class="line">        this.mockMvc = MockMvcBuilders.standaloneSetup(new AccountController()).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="u9009_u62E9_u54EA_u4E00_u79CD_uFF1F"><a href="#u9009_u62E9_u54EA_u4E00_u79CD_uFF1F" class="headerlink" title="选择哪一种？"></a>选择哪一种？</h5><ul>
<li>“webAppContextSetup”<ul>
<li>“webAppContextSetup” 加载实际的 Spring MVC 配置，能够提供一个更完整的集成测试。</li>
<li>而且 TestContext 框架能够缓存加载的 Spring 配置，保证测试能够快速运行。 </li>
<li>另外，你还可以通过 Spring 的配置，在 controller 中注入 mock 的 services，这样可以把关注点放在测试 web 层。</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 使用 Mockito 声明一个 mock 的 service </span><br><span class="line">&lt;bean id=<span class="string">"accountService"</span> class=<span class="string">"org.mockito.Mockito"</span> factory-method=<span class="string">"mock"</span>&gt;</span><br><span class="line">    &lt;constructor-arg value=<span class="string">"org.example.AccountService"</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">// 在测试中就可以使用这个 mock 的 service</span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">@WebAppConfiguration</span><br><span class="line">@ContextConfiguration(<span class="string">"test-servlet-context.xml"</span>)</span><br><span class="line">public class AccountTests &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private WebApplicationContext wac;</span><br><span class="line"></span><br><span class="line">    private MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AccountService accountService;</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>“standaloneSetup” <ul>
<li>“standaloneSetup” 更像单元测试，每次测一个 controller，controller 可以用 mock 的依赖手动注入，不需要加载 Spring 配置。</li>
<li>可以很容易的看到是在测是哪一个 controller</li>
<li>对于写 ad-hoc 测试来验证行为或者 debug 的时候很方便</li>
<li>要写 “webAppContextSetup” 测试来验证 Spring MVC 配置</li>
</ul>
</li>
</ul>
<h4 id="u6267_u884C_u8BF7_u6C42_Performing_Requests"><a href="#u6267_u884C_u8BF7_u6C42_Performing_Requests" class="headerlink" title="执行请求 Performing Requests"></a>执行请求 Performing Requests</h4><ul>
<li>用 HTTP 方法</li>
<li>用 file upload 请求</li>
</ul>
<h4 id="u5B9A_u4E49_Expectations"><a href="#u5B9A_u4E49_Expectations" class="headerlink" title="定义 Expectations"></a>定义 Expectations</h4><p>有两种类型</p>
<ul>
<li>验证 response 的属性，比如 response 的 status, headers, content</li>
<li>验证 Spring MVC 具体的事情，比如哪个 controller 的方法处理了这个请求，是否有 exception 抛出和处理，model 的内容是什么，选择了哪个 view 等。</li>
</ul>
<h2 id="u4E0E_u7AEF_u5230_u7AEF_u57FA_u7840_u6D4B_u8BD5_u7684_u533A_u522B"><a href="#u4E0E_u7AEF_u5230_u7AEF_u57FA_u7840_u6D4B_u8BD5_u7684_u533A_u522B" class="headerlink" title="与端到端基础测试的区别"></a>与端到端基础测试的区别</h2><ul>
<li>blank MockHttpServletRequest</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://weixiaobo88.github.io/2015/08/05/testing-in-spring/" data-id="cijptqmcu0001acje61abrsz1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring-test/">spring test</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/08/15/learn-jade/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Jade
        
      </div>
    </a>
  
  
    <a href="/2015/08/04/modular-programming-03/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">模块化编程 Modular Programming 03 —— require.js 的用法</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bind/">bind</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/functional-programming/">functional-programming</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/">gradle</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/modular-programming/">modular programming</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm-package-json/">npm, package.json</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-bootstrap/">react bootstrap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-router/">react router</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/servlet/">servlet</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-test/">spring test</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/bind/" style="font-size: 10px;">bind</a> <a href="/tags/functional-programming/" style="font-size: 13.33px;">functional-programming</a> <a href="/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/modular-programming/" style="font-size: 20px;">modular programming</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/npm-package-json/" style="font-size: 10px;">npm, package.json</a> <a href="/tags/react-bootstrap/" style="font-size: 10px;">react bootstrap</a> <a href="/tags/react-router/" style="font-size: 10px;">react router</a> <a href="/tags/servlet/" style="font-size: 13.33px;">servlet</a> <a href="/tags/spring/" style="font-size: 16.67px;">spring</a> <a href="/tags/spring-test/" style="font-size: 10px;">spring test</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/01/22/20160122-bind-in-javascript-md/">Bind in JavaScript</a>
          </li>
        
          <li>
            <a href="/2016/01/21/20160121-npm-package-file-md/">20160121-npm-package-file.md</a>
          </li>
        
          <li>
            <a href="/2016/01/18/20160118-functional-programming-monad/">Monad</a>
          </li>
        
          <li>
            <a href="/2016/01/14/20160114-functional-programming/">Functional Programming</a>
          </li>
        
          <li>
            <a href="/2016/01/12/20160112-React-Bootstrap-Introduction/">React-Bootstrap-Introduction</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Linne<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>